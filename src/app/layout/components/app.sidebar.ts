import { Component, ElementRef, ViewChild } from '@angular/core';
import { AppMenu } from './app.menu';
import { LayoutService } from '@/layout/service/layout.service';
import { RouterModule } from '@angular/router';

@Component({
    selector: '[app-sidebar]',
    standalone: true,
    imports: [AppMenu, RouterModule],
    template: ` <div
        class="layout-sidebar"
        (mouseenter)="onMouseEnter()"
        (mouseleave)="onMouseLeave()"
    >
        <div class="sidebar-header">
            <a [routerLink]="['/']" class="app-logo">
                <svg width="115" height="21" viewBox="0 0 115 21" fill="none" xmlns="http://www.w3.org/2000/svg" class="app-logo-normal" style="width: 200px; height: 32px;">
                <path d="M3.25 0.5H13.25C14.6172 0.5 15.75 1.63281 15.75 3V18C15.75 19.4062 14.6172 20.5 13.25 20.5H3.25C1.84375 20.5 0.75 19.4062 0.75 18V3C0.75 1.63281 1.84375 0.5 3.25 0.5ZM4.5 3C3.79688 3 3.25 3.58594 3.25 4.25V5.5C3.25 6.20312 3.79688 6.75 4.5 6.75H12C12.6641 6.75 13.25 6.20312 13.25 5.5V4.25C13.25 3.58594 12.6641 3 12 3H4.5ZM5.75 9.25C5.75 8.58594 5.16406 8 4.5 8C3.79688 8 3.25 8.58594 3.25 9.25C3.25 9.95312 3.79688 10.5 4.5 10.5C5.16406 10.5 5.75 9.95312 5.75 9.25ZM4.5 14.25C5.16406 14.25 5.75 13.7031 5.75 13C5.75 12.3359 5.16406 11.75 4.5 11.75C3.79688 11.75 3.25 12.3359 3.25 13C3.25 13.7031 3.79688 14.25 4.5 14.25ZM3.25 16.75C3.25 17.4531 3.79688 18 4.5 18H8.25C8.91406 18 9.5 17.4531 9.5 16.75C9.5 16.0859 8.91406 15.5 8.25 15.5H4.5C3.79688 15.5 3.25 16.0859 3.25 16.75ZM8.25 10.5C8.91406 10.5 9.5 9.95312 9.5 9.25C9.5 8.58594 8.91406 8 8.25 8C7.54688 8 7 8.58594 7 9.25C7 9.95312 7.54688 10.5 8.25 10.5ZM9.5 13C9.5 12.3359 8.91406 11.75 8.25 11.75C7.54688 11.75 7 12.3359 7 13C7 13.7031 7.54688 14.25 8.25 14.25C8.91406 14.25 9.5 13.7031 9.5 13ZM12 10.5C12.6641 10.5 13.25 9.95312 13.25 9.25C13.25 8.58594 12.6641 8 12 8C11.2969 8 10.75 8.58594 10.75 9.25C10.75 9.95312 11.2969 10.5 12 10.5ZM13.25 13C13.25 12.3359 12.6641 11.75 12 11.75C11.2969 11.75 10.75 12.3359 10.75 13C10.75 13.7031 11.2969 14.25 12 14.25C12.6641 14.25 13.25 13.7031 13.25 13ZM12 18C12.6641 18 13.25 17.4531 13.25 16.75C13.25 16.0859 12.6641 15.5 12 15.5C11.2969 15.5 10.75 16.0859 10.75 16.75C10.75 17.4531 11.2969 18 12 18Z" fill="var(--logo-color)"/>
                <path d="M22.8281 15.5V3.85938H27.5938C28.4896 3.85938 29.2656 4.02083 29.9219 4.34375C30.5781 4.66146 31.0833 5.11458 31.4375 5.70312C31.7969 6.29167 31.9766 6.98958 31.9766 7.79688C31.9766 8.59896 31.7969 9.29427 31.4375 9.88281C31.0781 10.4714 30.5677 10.9271 29.9062 11.25C29.25 11.5729 28.474 11.7344 27.5781 11.7344H25.6406V15.5H22.8281ZM25.6406 9.39844H27.3984C27.9609 9.39844 28.4062 9.25521 28.7344 8.96875C29.0677 8.67708 29.2344 8.28646 29.2344 7.79688C29.2344 7.30208 29.0677 6.91146 28.7344 6.625C28.4062 6.33333 27.9609 6.1875 27.3984 6.1875H25.6406V9.39844ZM37.3828 15.5H33.0625V3.85938H37.3828C38.5651 3.85938 39.5911 4.09896 40.4609 4.57812C41.3307 5.05208 42.0026 5.72396 42.4766 6.59375C42.9557 7.46354 43.1953 8.49219 43.1953 9.67969C43.1953 10.8672 42.9583 11.8958 42.4844 12.7656C42.0156 13.6354 41.3464 14.3099 40.4766 14.7891C39.6068 15.263 38.5755 15.5 37.3828 15.5ZM35.875 13.1562H37.2422C38.3099 13.1562 39.0964 12.8646 39.6016 12.2812C40.112 11.6927 40.3672 10.8255 40.3672 9.67969C40.3672 8.53385 40.1094 7.66927 39.5938 7.08594C39.0781 6.4974 38.2839 6.20312 37.2109 6.20312H35.875V13.1562ZM42.9453 15.5L46.9453 3.85938H50.6484L54.6719 15.5H51.5312L50.8438 13.2578H46.7109L46 15.5H42.9453ZM47.4141 11.0625H50.1641L49.9531 10.3828C49.7604 9.73177 49.5677 9.08073 49.375 8.42969C49.1875 7.77865 48.9974 7.09635 48.8047 6.38281C48.6068 7.09635 48.4115 7.77865 48.2188 8.42969C48.026 9.08073 47.8281 9.73177 47.625 10.3828L47.4141 11.0625Z" fill="var(--logo-color)"/>
                <path d="M59 15.6875C58.1562 15.6875 57.4141 15.5026 56.7734 15.1328C56.138 14.763 55.6406 14.2552 55.2812 13.6094C54.9271 12.9583 54.75 12.2135 54.75 11.375C54.75 10.5365 54.9271 9.79427 55.2812 9.14844C55.6406 8.4974 56.1354 7.98698 56.7656 7.61719C57.3958 7.2474 58.1172 7.0625 58.9297 7.0625C59.7578 7.0625 60.4844 7.24479 61.1094 7.60938C61.7396 7.96875 62.2318 8.46875 62.5859 9.10938C62.9401 9.74479 63.1172 10.4792 63.1172 11.3125V12.0391H57.375C57.3906 12.5651 57.5469 12.9818 57.8438 13.2891C58.1458 13.5964 58.5625 13.75 59.0938 13.75C59.4896 13.75 59.8203 13.6693 60.0859 13.5078C60.3568 13.3464 60.5417 13.1302 60.6406 12.8594H63.0547C62.9557 13.4115 62.7161 13.901 62.3359 14.3281C61.9557 14.7552 61.4766 15.0885 60.8984 15.3281C60.3255 15.5677 59.6927 15.6875 59 15.6875ZM57.3906 10.4297H60.6094C60.5469 9.9974 60.375 9.65885 60.0938 9.41406C59.8125 9.16927 59.4479 9.04688 59 9.04688C58.5469 9.04688 58.1797 9.16927 57.8984 9.41406C57.6172 9.65885 57.4479 9.9974 57.3906 10.4297ZM63.2188 15.5L66.125 11.2969L63.4375 7.25H66.3359L66.9062 8.21094C67.0365 8.44531 67.1615 8.67188 67.2812 8.89062C67.401 9.10938 67.5156 9.32292 67.625 9.53125C67.7448 9.32292 67.8646 9.10938 67.9844 8.89062C68.1042 8.67188 68.2318 8.44531 68.3672 8.21094L68.9531 7.25H71.8125L69.0781 11.2266L71.9375 15.5H69.0234L68.3984 14.4766C68.2526 14.2266 68.1146 13.9844 67.9844 13.75C67.8542 13.5156 67.724 13.2865 67.5938 13.0625C67.4635 13.2865 67.3333 13.5156 67.2031 13.75C67.0729 13.9844 66.9323 14.2266 66.7812 14.4766L66.1328 15.5H63.2188ZM72.7344 18.7656V7.25H75.3906V8.32812H75.4297C75.9245 7.48958 76.7161 7.07031 77.8047 7.07031C78.5026 7.07031 79.1172 7.2526 79.6484 7.61719C80.1797 7.98177 80.5938 8.48698 80.8906 9.13281C81.1927 9.77865 81.3438 10.5208 81.3438 11.3594C81.3438 12.2292 81.1953 12.9896 80.8984 13.6406C80.6068 14.2865 80.1927 14.7891 79.6562 15.1484C79.125 15.5026 78.5 15.6797 77.7812 15.6797C76.6667 15.6797 75.8906 15.2109 75.4531 14.2734H75.4219V18.7656H72.7344ZM77.0234 13.5312C77.5182 13.5312 77.9089 13.3385 78.1953 12.9531C78.4818 12.5677 78.625 12.0365 78.625 11.3594C78.625 10.6875 78.4818 10.1615 78.1953 9.78125C77.9089 9.40104 77.5182 9.21094 77.0234 9.21094C76.5182 9.21094 76.1068 9.40625 75.7891 9.79688C75.4714 10.1875 75.3125 10.7083 75.3125 11.3594C75.3125 12.0208 75.4714 12.5495 75.7891 12.9453C76.1068 13.3359 76.5182 13.5312 77.0234 13.5312ZM82.5156 15.5V7.25H85.1172V8.70312H85.1406C85.2917 8.17708 85.526 7.79948 85.8438 7.57031C86.1667 7.33594 86.6042 7.21875 87.1562 7.21875C87.3021 7.21875 87.4323 7.22135 87.5469 7.22656C87.6667 7.22656 87.7812 7.22917 87.8906 7.23438V9.45312C87.7917 9.44792 87.638 9.44271 87.4297 9.4375C87.2214 9.43229 87.0208 9.42969 86.8281 9.42969C86.3438 9.42969 85.9505 9.59115 85.6484 9.91406C85.3516 10.237 85.2031 10.6901 85.2031 11.2734V15.5H82.5156ZM92.6719 15.6875C91.8281 15.6875 91.0859 15.5026 90.4453 15.1328C89.8099 14.763 89.3125 14.2552 88.9531 13.6094C88.599 12.9583 88.4219 12.2135 88.4219 11.375C88.4219 10.5365 88.599 9.79427 88.9531 9.14844C89.3125 8.4974 89.8073 7.98698 90.4375 7.61719C91.0677 7.2474 91.7891 7.0625 92.6016 7.0625C93.4297 7.0625 94.1562 7.24479 94.7812 7.60938C95.4115 7.96875 95.9036 8.46875 96.2578 9.10938C96.612 9.74479 96.7891 10.4792 96.7891 11.3125V12.0391H91.0469C91.0625 12.5651 91.2188 12.9818 91.5156 13.2891C91.8177 13.5964 92.2344 13.75 92.7656 13.75C93.1615 13.75 93.4922 13.6693 93.7578 13.5078C94.0286 13.3464 94.2135 13.1302 94.3125 12.8594H96.7266C96.6276 13.4115 96.388 13.901 96.0078 14.3281C95.6276 14.7552 95.1484 15.0885 94.5703 15.3281C93.9974 15.5677 93.3646 15.6875 92.6719 15.6875ZM91.0625 10.4297H94.2812C94.2188 9.9974 94.0469 9.65885 93.7656 9.41406C93.4844 9.16927 93.1198 9.04688 92.6719 9.04688C92.2188 9.04688 91.8516 9.16927 91.5703 9.41406C91.2891 9.65885 91.1198 9.9974 91.0625 10.4297ZM101.562 15.7031C100.802 15.7031 100.128 15.5885 99.5391 15.3594C98.9505 15.1302 98.4792 14.8021 98.125 14.375C97.776 13.9479 97.5781 13.4427 97.5312 12.8594H100.18C100.221 13.1667 100.357 13.4089 100.586 13.5859C100.815 13.763 101.128 13.8516 101.523 13.8516C101.893 13.8516 102.182 13.7865 102.391 13.6562C102.599 13.526 102.703 13.3568 102.703 13.1484C102.703 12.8047 102.37 12.5729 101.703 12.4531L100.211 12.1875C99.3984 12.0417 98.7786 11.763 98.3516 11.3516C97.9297 10.9401 97.7188 10.4089 97.7188 9.75781C97.7188 8.94531 98.0469 8.29688 98.7031 7.8125C99.3594 7.32292 100.263 7.07812 101.414 7.07812C102.565 7.07812 103.482 7.33333 104.164 7.84375C104.846 8.35417 105.201 9.04948 105.227 9.92969H102.75C102.745 9.64323 102.625 9.40365 102.391 9.21094C102.161 9.01823 101.867 8.92188 101.508 8.92188C101.159 8.92188 100.885 8.98958 100.688 9.125C100.495 9.26042 100.398 9.42969 100.398 9.63281C100.398 9.97135 100.695 10.1979 101.289 10.3125L102.945 10.6172C103.794 10.7734 104.422 11.0339 104.828 11.3984C105.234 11.763 105.438 12.2526 105.438 12.8672C105.438 13.4297 105.273 13.9245 104.945 14.3516C104.622 14.7786 104.169 15.112 103.586 15.3516C103.008 15.5859 102.333 15.7031 101.562 15.7031ZM110.188 15.7031C109.427 15.7031 108.753 15.5885 108.164 15.3594C107.576 15.1302 107.104 14.8021 106.75 14.375C106.401 13.9479 106.203 13.4427 106.156 12.8594H108.805C108.846 13.1667 108.982 13.4089 109.211 13.5859C109.44 13.763 109.753 13.8516 110.148 13.8516C110.518 13.8516 110.807 13.7865 111.016 13.6562C111.224 13.526 111.328 13.3568 111.328 13.1484C111.328 12.8047 110.995 12.5729 110.328 12.4531L108.836 12.1875C108.023 12.0417 107.404 11.763 106.977 11.3516C106.555 10.9401 106.344 10.4089 106.344 9.75781C106.344 8.94531 106.672 8.29688 107.328 7.8125C107.984 7.32292 108.888 7.07812 110.039 7.07812C111.19 7.07812 112.107 7.33333 112.789 7.84375C113.471 8.35417 113.826 9.04948 113.852 9.92969H111.375C111.37 9.64323 111.25 9.40365 111.016 9.21094C110.786 9.01823 110.492 8.92188 110.133 8.92188C109.784 8.92188 109.51 8.98958 109.312 9.125C109.12 9.26042 109.023 9.42969 109.023 9.63281C109.023 9.97135 109.32 10.1979 109.914 10.3125L111.57 10.6172C112.419 10.7734 113.047 11.0339 113.453 11.3984C113.859 11.763 114.062 12.2526 114.062 12.8672C114.062 13.4297 113.898 13.9245 113.57 14.3516C113.247 14.7786 112.794 15.112 112.211 15.3516C111.633 15.5859 110.958 15.7031 110.188 15.7031Z" fill="var(--logo-color)"/>
                </svg>

                <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="app-logo-small">
                    <path d="M10 5.5H20C21.3672 5.5 22.5 6.63281 22.5 8V23C22.5 24.4062 21.3672 25.5 20 25.5H10C8.59375 25.5 7.5 24.4062 7.5 23V8C7.5 6.63281 8.59375 5.5 10 5.5ZM11.25 8C10.5469 8 10 8.58594 10 9.25V10.5C10 11.2031 10.5469 11.75 11.25 11.75H18.75C19.4141 11.75 20 11.2031 20 10.5V9.25C20 8.58594 19.4141 8 18.75 8H11.25ZM12.5 14.25C12.5 13.5859 11.9141 13 11.25 13C10.5469 13 10 13.5859 10 14.25C10 14.9531 10.5469 15.5 11.25 15.5C11.9141 15.5 12.5 14.9531 12.5 14.25ZM11.25 19.25C11.9141 19.25 12.5 18.7031 12.5 18C12.5 17.3359 11.9141 16.75 11.25 16.75C10.5469 16.75 10 17.3359 10 18C10 18.7031 10.5469 19.25 11.25 19.25ZM10 21.75C10 22.4531 10.5469 23 11.25 23H15C15.6641 23 16.25 22.4531 16.25 21.75C16.25 21.0859 15.6641 20.5 15 20.5H11.25C10.5469 20.5 10 21.0859 10 21.75ZM15 15.5C15.6641 15.5 16.25 14.9531 16.25 14.25C16.25 13.5859 15.6641 13 15 13C14.2969 13 13.75 13.5859 13.75 14.25C13.75 14.9531 14.2969 15.5 15 15.5ZM16.25 18C16.25 17.3359 15.6641 16.75 15 16.75C14.2969 16.75 13.75 17.3359 13.75 18C13.75 18.7031 14.2969 19.25 15 19.25C15.6641 19.25 16.25 18.7031 16.25 18ZM18.75 15.5C19.4141 15.5 20 14.9531 20 14.25C20 13.5859 19.4141 13 18.75 13C18.0469 13 17.5 13.5859 17.5 14.25C17.5 14.9531 18.0469 15.5 18.75 15.5ZM20 18C20 17.3359 19.4141 16.75 18.75 16.75C18.0469 16.75 17.5 17.3359 17.5 18C17.5 18.7031 18.0469 19.25 18.75 19.25C19.4141 19.25 20 18.7031 20 18ZM18.75 23C19.4141 23 20 22.4531 20 21.75C20 21.0859 19.4141 20.5 18.75 20.5C18.0469 20.5 17.5 21.0859 17.5 21.75C17.5 22.4531 18.0469 23 18.75 23Z" fill="var(--logo-color)"/>
                </svg>
            </a>
            <button
                class="layout-sidebar-anchor p-link z-2"
                type="button"
                (click)="anchor()"
            ></button>
        </div>

        <div #menuContainer class="layout-menu-container">
            <app-menu></app-menu>
        </div>
    </div>`,
})
export class AppSidebar {
    timeout: any = null;

    @ViewChild('menuContainer') menuContainer!: ElementRef;
    constructor(
        public layoutService: LayoutService,
        public el: ElementRef,
    ) {}

    onMouseEnter() {
        if (!this.layoutService.layoutState().anchored) {
            if (this.timeout) {
                clearTimeout(this.timeout);
                this.timeout = null;
            }

            this.layoutService.layoutState.update((state) => {
                if (!state.sidebarActive) {
                    return {
                        ...state,
                        sidebarActive: true,
                    };
                }
                return state;
            });
        }
    }

    onMouseLeave() {
        if (!this.layoutService.layoutState().anchored) {
            if (!this.timeout) {
                this.timeout = setTimeout(() => {
                    this.layoutService.layoutState.update((state) => {
                        if (state.sidebarActive) {
                            return {
                                ...state,
                                sidebarActive: false,
                            };
                        }
                        return state;
                    });
                }, 300);
            }
        }
    }

    anchor() {
        this.layoutService.layoutState.update((state) => ({
            ...state,
            anchored: !state.anchored,
        }));
    }
}
